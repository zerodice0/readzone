# Feature Specification: 사용자 등록 및 로그인

**Feature Branch**: `001-feature`
**Created**: 2025-11-05
**Status**: Draft
**Input**: User description: "사용자 등록 및 로그인 기능"

## Clarifications

### Session 2025-01-06

- Q: 세션 만료 정책 - 보안과 사용자 경험 사이의 균형을 위한 세션 만료 시간이 필요합니다. → A: 단기 세션 정책 (로그인 유지 미선택: 24시간, 선택: 30일)
- Q: 로그인 시도 제한 - 무차별 대입 공격 방어를 위한 로그인 시도 제한 정책이 필요합니다. → A: 중간 제한 정책 (10회 실패 시 15분 계정 잠금)
- Q: 소셜 로그인 실패 시 재시도 정책 - 일시적 오류(네트워크 장애, 제공업체 서버 문제) 발생 시 재시도 방안이 필요합니다. → A: 즉시 실패 (재시도 없음, 사용자가 직접 다시 클릭)
- Q: 탈퇴 계정 데이터 보관 정책 - 탈퇴 후 같은 이메일/닉네임으로 재가입하려는 사용자를 위한 정책이 필요합니다. → A: 30일 유예 정책 (탈퇴 후 30일간 이메일/닉네임 재사용 불가)
- Q: 이메일 발송 실패 처리 - SMTP 서비스 장애 시 사용자 알림 방안이 필요합니다. → A: 즉시 오류 표시 ("이메일 발송 실패, 잠시 후 재시도해주세요")

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 이메일 기반 신규 회원가입 (Priority: P1)

신규 사용자가 이메일과 비밀번호를 사용하여 ReadZone 계정을 생성하고, 이메일 인증을 완료하여 독후감 작성 권한을 획득한다.

**Why this priority**: 가장 기본적인 사용자 유입 경로이며, 소셜 로그인에 의존하지 않는 독립적인 인증 수단을 제공한다. 이메일 인증을 통해 스팸 계정을 방지하고 사용자 신원을 확인한다.

**Independent Test**: 회원가입 폼에서 유효한 정보를 입력하고, 이메일 인증 링크를 클릭하면 독후감 작성이 가능한 상태가 되는지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 회원가입 페이지에 접속했을 때, **When** 이메일, 비밀번호(8자 이상), 닉네임을 입력하고 "가입하기" 버튼을 클릭하면, **Then** 인증 이메일이 발송되고 "이메일 인증을 완료해주세요" 메시지가 표시된다.
2. **Given** 사용자가 인증 이메일을 받았을 때, **When** 이메일 내의 인증 링크를 클릭하면, **Then** 이메일 인증이 완료되고 로그인 페이지로 리디렉션된다.
3. **Given** 이메일 인증을 완료한 사용자가 로그인했을 때, **When** 독후감 작성 페이지에 접근하면, **Then** 독후감 작성이 가능하다.
4. **Given** 이메일 인증을 완료하지 않은 사용자가 로그인했을 때, **When** 독후감 작성을 시도하면, **Then** "이메일 인증이 필요합니다" 메시지와 함께 작성이 차단된다.

---

### User Story 2 - 소셜 계정 간편 가입 및 로그인 (Priority: P1)

사용자가 카카오, 네이버, 또는 구글 계정을 사용하여 빠르게 회원가입 및 로그인을 완료한다.

**Why this priority**: 소셜 로그인은 사용자의 가입 장벽을 낮추고 편의성을 높인다. 이메일 인증 절차가 소셜 제공업체를 통해 이미 완료되었으므로 즉시 모든 기능을 사용할 수 있다.

**Independent Test**: 소셜 로그인 버튼을 클릭하고 외부 인증을 완료하면 자동으로 계정이 생성되고 로그인된 상태에서 독후감 작성이 가능한지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 로그인 페이지에 접속했을 때, **When** "카카오로 시작하기" 버튼을 클릭하면, **Then** 카카오 인증 페이지로 이동한다.
2. **Given** 카카오 인증 페이지에서, **When** 사용자가 카카오 로그인 및 권한 동의를 완료하면, **Then** ReadZone으로 리디렉션되고 자동으로 로그인된 상태가 된다.
3. **Given** 최초 소셜 로그인 사용자일 때, **When** 소셜 인증이 완료되면, **Then** 닉네임 설정 화면이 표시되고 닉네임 입력 후 즉시 모든 기능(독후감 작성 포함)을 사용할 수 있다.
4. **Given** 이미 소셜 계정으로 가입한 사용자가, **When** 같은 소셜 로그인 버튼을 다시 클릭하면, **Then** 별도의 가입 절차 없이 즉시 로그인된다.

---

### User Story 3 - 로그인 및 세션 유지 (Priority: P1)

등록된 사용자가 이메일/비밀번호 또는 소셜 계정으로 로그인하고, "로그인 상태 유지" 옵션을 통해 재방문 시 자동 로그인된다.

**Why this priority**: 로그인은 모든 개인화된 기능의 전제 조건이며, 세션 유지는 사용자 편의성을 크게 향상시킨다.

**Independent Test**: 로그인 폼에서 "로그인 상태 유지"를 체크하고 로그인한 뒤 브라우저를 닫았다가 다시 열었을 때 로그인 상태가 유지되는지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 사용자가 로그인 페이지에 접속했을 때, **When** 올바른 이메일과 비밀번호를 입력하고 로그인하면, **Then** 메인 페이지로 이동하고 로그인된 상태가 된다.
2. **Given** 로그인 페이지에서, **When** "로그인 상태 유지" 체크박스를 선택하고 로그인하면, **Then** 브라우저를 닫았다가 다시 열어도 30일 동안 로그인 상태가 유지된다.
3. **Given** "로그인 상태 유지"를 선택하지 않고 로그인했을 때, **When** 24시간이 경과하면, **Then** 세션이 만료되어 다시 로그인해야 한다.
4. **Given** 잘못된 비밀번호를 입력했을 때, **When** 로그인을 시도하면, **Then** "이메일 또는 비밀번호가 올바르지 않습니다" 메시지가 표시된다.
5. **Given** 동일 계정에서 10회 연속 로그인 실패했을 때, **When** 11번째 로그인을 시도하면, **Then** "보안을 위해 계정이 일시적으로 잠금되었습니다. 15분 후 다시 시도해주세요" 메시지가 표시되고 로그인이 차단된다.

---

### User Story 4 - 비밀번호 재설정 (Priority: P2)

사용자가 비밀번호를 잊어버렸을 때 이메일을 통해 안전하게 비밀번호를 재설정한다.

**Why this priority**: 비밀번호 분실은 빈번하게 발생하는 문제이며, 사용자 이탈을 방지하기 위해 필수적인 기능이다. P1보다 낮은 우선순위인 이유는 초기 MVP에서는 관리자 지원으로 대체 가능하기 때문이다.

**Independent Test**: 로그인 페이지에서 "비밀번호 찾기"를 클릭하고 이메일을 입력하면 재설정 링크가 발송되고, 링크를 통해 새 비밀번호를 설정할 수 있는지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 로그인 페이지에 있을 때, **When** "비밀번호를 잊으셨나요?" 링크를 클릭하면, **Then** 이메일 입력 페이지로 이동한다.
2. **Given** 비밀번호 재설정 페이지에서, **When** 등록된 이메일을 입력하고 제출하면, **Then** "비밀번호 재설정 링크를 이메일로 발송했습니다" 메시지가 표시된다.
3. **Given** 사용자가 재설정 이메일을 받았을 때, **When** 이메일 내의 재설정 링크를 클릭하면, **Then** 새 비밀번호 입력 페이지로 이동한다.
4. **Given** 새 비밀번호 입력 페이지에서, **When** 8자 이상의 새 비밀번호를 입력하고 제출하면, **Then** "비밀번호가 변경되었습니다" 메시지와 함께 로그인 페이지로 리디렉션된다.

---

### User Story 5 - 계정 정보 관리 (Priority: P2)

로그인한 사용자가 자신의 닉네임, 이메일을 변경하거나 계정을 탈퇴할 수 있다.

**Why this priority**: 사용자가 자신의 정보를 관리할 수 있는 권한은 중요하지만, 초기 MVP에서는 계정 생성 후 즉시 필요하지 않으므로 P2로 분류한다.

**Independent Test**: 설정 페이지에서 닉네임을 변경하거나 계정 탈퇴를 실행했을 때 해당 변경사항이 즉시 반영되는지 확인할 수 있다.

**Acceptance Scenarios**:

1. **Given** 로그인한 사용자가 설정 페이지에 접속했을 때, **When** 새로운 닉네임을 입력하고 저장하면, **Then** "닉네임이 변경되었습니다" 메시지가 표시되고 모든 곳에서 새 닉네임이 표시된다.
2. **Given** 설정 페이지에서, **When** 새로운 이메일 주소를 입력하고 저장하면, **Then** 새 이메일로 인증 링크가 발송되고 인증 완료 후 이메일이 변경된다.
3. **Given** 설정 페이지에서, **When** "계정 탈퇴" 버튼을 클릭하면, **Then** 탈퇴 확인 대화상자가 표시된다.
4. **Given** 탈퇴 확인 대화상자에서, **When** "탈퇴하기"를 확인하면, **Then** 계정이 삭제되고 로그아웃된 후 메인 페이지로 리디렉션된다.

---

### Edge Cases

- **중복 계정**: 이미 등록된 이메일로 회원가입을 시도하면 "이미 사용 중인 이메일입니다" 메시지를 표시한다.
- **소셜 로그인과 이메일 계정 연동**: 같은 이메일 주소로 이메일 가입과 소셜 로그인을 모두 사용한 경우, 두 계정을 별도로 관리한다 (초기 버전에서는 계정 병합 미지원).
- **인증 링크 만료**: 이메일 인증 링크는 24시간 후 만료되며, 만료된 링크 클릭 시 "인증 링크가 만료되었습니다. 새로운 인증 이메일을 요청해주세요" 메시지를 표시한다.
- **비밀번호 재설정 링크 만료**: 비밀번호 재설정 링크는 1시간 후 만료되며, 만료된 링크 클릭 시 "재설정 링크가 만료되었습니다" 메시지를 표시한다.
- **소셜 로그인 실패**: 소셜 제공업체에서 인증 실패 시 "소셜 로그인에 실패했습니다. 다시 시도해주세요" 메시지를 표시하고 로그인 페이지로 돌아간다. 자동 재시도는 수행하지 않으며, 사용자가 직접 다시 로그인 버튼을 클릭해야 한다.
- **비밀번호 복잡도 미달**: 8자 미만의 비밀번호 입력 시 "비밀번호는 최소 8자 이상이어야 합니다" 메시지를 표시한다.
- **닉네임 중복**: 이미 사용 중인 닉네임 입력 시 "이미 사용 중인 닉네임입니다" 메시지를 표시한다.
- **이메일 발송 실패**: SMTP 서비스 장애 등으로 인증 이메일, 비밀번호 재설정 이메일, 이메일 변경 인증 이메일 발송이 실패할 경우 "이메일 발송에 실패했습니다. 잠시 후 다시 시도해주세요" 메시지를 즉시 표시한다. 자동 재시도는 수행하지 않으며, 사용자가 직접 재발송을 요청해야 한다.
- **로그인 시도 과다**: 동일 계정에서 10회 연속 로그인 실패 시 해당 계정은 15분간 잠금되며, "보안을 위해 계정이 일시적으로 잠금되었습니다. 15분 후 다시 시도해주세요" 메시지를 표시한다.
- **탈퇴 후 재가입**: 탈퇴한 계정의 이메일/닉네임은 탈퇴 후 30일간 재사용이 불가능하다. 30일 경과 후 같은 이메일/닉네임으로 재가입 시 새로운 계정으로 처리되며 이전 데이터는 복구되지 않는다. 30일 이내 재가입 시도 시 "해당 이메일/닉네임은 탈퇴 후 30일간 재사용할 수 없습니다" 메시지를 표시한다.

## Requirements *(mandatory)*

### Functional Requirements

**회원가입**
- **FR-001**: 시스템은 이메일, 비밀번호(최소 8자), 닉네임을 입력받아 신규 계정을 생성할 수 있어야 한다.
- **FR-002**: 시스템은 이메일 형식의 유효성을 검증해야 한다.
- **FR-003**: 시스템은 중복된 이메일 또는 닉네임 사용을 방지해야 한다.
- **FR-004**: 시스템은 회원가입 시 입력된 이메일로 인증 링크를 발송해야 한다.
- **FR-004-1**: 시스템은 이메일 발송 실패 시 "이메일 발송에 실패했습니다. 잠시 후 다시 시도해주세요" 메시지를 즉시 표시해야 한다.
- **FR-005**: 시스템은 카카오, 네이버, 구글 OAuth를 통한 소셜 로그인 기반 회원가입을 지원해야 한다.
- **FR-006**: 시스템은 소셜 로그인 사용자에 대해 닉네임 입력을 요구해야 한다.

**이메일 인증**
- **FR-007**: 시스템은 이메일 인증 링크를 24시간 동안 유효하게 유지해야 한다.
- **FR-008**: 시스템은 이메일 인증이 완료되지 않은 사용자의 독후감 작성 기능을 제한해야 한다.
- **FR-009**: 시스템은 이메일 인증이 완료되지 않은 사용자에게 "이메일 인증이 필요합니다" 안내 메시지를 표시해야 한다.
- **FR-010**: 시스템은 사용자가 인증 이메일 재발송을 요청할 수 있어야 한다.
- **FR-010-1**: 시스템은 인증 이메일 재발송 실패 시 "이메일 발송에 실패했습니다. 잠시 후 다시 시도해주세요" 메시지를 즉시 표시해야 한다.

**로그인**
- **FR-011**: 시스템은 이메일과 비밀번호를 사용한 로그인을 지원해야 한다.
- **FR-012**: 시스템은 카카오, 네이버, 구글 OAuth를 통한 소셜 로그인을 지원해야 한다.
- **FR-013**: 시스템은 "로그인 상태 유지" 옵션을 제공해야 한다.
- **FR-013-1**: 시스템은 "로그인 상태 유지"를 선택하지 않은 경우 24시간 후 세션을 만료시켜야 한다.
- **FR-013-2**: 시스템은 "로그인 상태 유지"를 선택한 경우 30일 후 세션을 만료시켜야 한다.
- **FR-014**: 시스템은 잘못된 인증 정보 입력 시 "이메일 또는 비밀번호가 올바르지 않습니다" 메시지를 표시해야 한다.
- **FR-014-1**: 시스템은 동일 계정에서 10회 연속 로그인 실패 시 해당 계정을 15분간 잠금 처리해야 한다.
- **FR-014-2**: 시스템은 계정 잠금 시 "보안을 위해 계정이 일시적으로 잠금되었습니다. 15분 후 다시 시도해주세요" 메시지를 표시해야 한다.
- **FR-015**: 시스템은 로그인 성공 시 사용자를 메인 페이지로 리디렉션해야 한다.

**비밀번호 관리**
- **FR-016**: 사용자는 비밀번호를 잊어버린 경우 이메일을 통해 비밀번호 재설정 링크를 요청할 수 있어야 한다.
- **FR-016-1**: 시스템은 비밀번호 재설정 이메일 발송 실패 시 "이메일 발송에 실패했습니다. 잠시 후 다시 시도해주세요" 메시지를 즉시 표시해야 한다.
- **FR-017**: 시스템은 비밀번호 재설정 링크를 1시간 동안 유효하게 유지해야 한다.
- **FR-018**: 시스템은 비밀번호 재설정 시 최소 8자 이상의 새 비밀번호를 요구해야 한다.
- **FR-019**: 시스템은 비밀번호를 안전하게 해시하여 저장해야 한다.

**계정 관리**
- **FR-020**: 로그인한 사용자는 자신의 닉네임을 변경할 수 있어야 한다.
- **FR-021**: 로그인한 사용자는 자신의 이메일을 변경할 수 있어야 하며, 새 이메일로 인증 절차를 거쳐야 한다.
- **FR-021-1**: 시스템은 이메일 변경 인증 이메일 발송 실패 시 "이메일 발송에 실패했습니다. 잠시 후 다시 시도해주세요" 메시지를 즉시 표시해야 한다.
- **FR-022**: 로그인한 사용자는 계정을 탈퇴할 수 있어야 한다.
- **FR-023**: 시스템은 계정 탈퇴 시 확인 절차를 거쳐야 한다.
- **FR-024**: 시스템은 탈퇴한 계정의 개인정보를 삭제해야 한다 (작성한 독후감은 "탈퇴한 사용자"로 표시 유지).
- **FR-024-1**: 시스템은 탈퇴한 계정의 이메일과 닉네임을 30일간 재사용 불가능하도록 보관해야 한다.
- **FR-024-2**: 시스템은 탈퇴 후 30일이 경과하면 해당 이메일과 닉네임을 다른 사용자가 사용할 수 있도록 해제해야 한다.

**보안**
- **FR-025**: 시스템은 로그인 시도, 비밀번호 변경, 계정 탈퇴 등 주요 보안 이벤트를 로그로 기록해야 한다.
- **FR-026**: 시스템은 민감한 정보(비밀번호, 토큰)를 로그에 기록하지 않아야 한다.

### Key Entities

- **User (사용자)**: 시스템 사용자 계정을 나타낸다. 주요 속성: 이메일(고유), 닉네임(고유), 비밀번호 해시, 이메일 인증 여부, 가입 일시, 소셜 로그인 제공업체 정보(선택적), 계정 상태(활성/탈퇴), 탈퇴 일시(선택적).
- **DeletedAccount (탈퇴 계정)**: 탈퇴한 계정의 이메일/닉네임 재사용 방지를 위한 임시 보관 정보. 주요 속성: 탈퇴한 이메일, 탈퇴한 닉네임, 탈퇴 일시, 재사용 가능 일시 (탈퇴 일시 + 30일).
- **EmailVerification (이메일 인증)**: 이메일 인증 요청 및 상태를 나타낸다. 주요 속성: 사용자 참조, 인증 토큰, 발급 일시, 만료 일시, 인증 완료 여부.
- **PasswordReset (비밀번호 재설정)**: 비밀번호 재설정 요청을 나타낸다. 주요 속성: 사용자 참조, 재설정 토큰, 발급 일시, 만료 일시, 사용 여부.
- **Session (세션)**: 사용자 로그인 세션을 나타낸다. 주요 속성: 사용자 참조, 세션 토큰, 생성 일시, 만료 일시 ("로그인 유지" 미선택 시 24시간, 선택 시 30일), "로그인 유지" 여부.
- **LoginAttempt (로그인 시도)**: 로그인 실패 추적을 나타낸다. 주요 속성: 사용자 참조 또는 시도한 이메일, 시도 일시, 성공/실패 여부, 계정 잠금 상태, 잠금 해제 일시.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자는 이메일 기반 회원가입을 2분 이내에 완료할 수 있다 (이메일 인증 링크 클릭 제외).
- **SC-002**: 사용자는 소셜 로그인을 통해 30초 이내에 회원가입 및 로그인을 완료할 수 있다.
- **SC-003**: 로그인 프로세스는 1초 이내에 완료된다 (소셜 인증 제공업체 응답 시간 제외).
- **SC-004**: 이메일 인증 링크는 발송 후 5분 이내에 사용자의 메일함에 도착한다.
- **SC-005**: 비밀번호 재설정 프로세스는 3분 이내에 완료될 수 있다 (이메일 확인 시간 제외).
- **SC-006**: 신규 사용자의 90% 이상이 첫 시도에서 성공적으로 회원가입을 완료한다.
- **SC-007**: "로그인 상태 유지" 옵션을 선택한 사용자의 95% 이상이 재방문 시 자동 로그인된다.
- **SC-008**: 시스템은 동시에 1,000명의 사용자 로그인 요청을 처리할 수 있다.
- **SC-009**: 인증 관련 보안 이벤트(로그인 실패, 비밀번호 변경 등)의 100%가 로그에 기록된다.
- **SC-010**: 사용자 계정 관련 지원 요청이 월 평균 10건 이하로 유지된다 (사용자 1,000명 기준).

## Assumptions

- 사용자는 유효한 이메일 주소를 소유하고 있으며, 이메일을 확인할 수 있다.
- 소셜 로그인 제공업체(카카오, 네이버, 구글)의 API는 99% 이상의 가용성을 유지한다.
- 사용자의 대부분은 모바일 또는 데스크톱 웹 브라우저를 통해 접속한다.
- 초기 사용자 규모는 1,000명 이하이며, 동시 접속자는 100명 이하이다.
- SMTP 이메일 발송 서비스(예: SendGrid, AWS SES)를 사용할 수 있다.
- 비밀번호 해시는 업계 표준 알고리즘(bcrypt, Argon2 등)을 사용한다.
- 소셜 로그인과 이메일 계정 병합 기능은 초기 버전에서 제공하지 않는다.
- 탈퇴한 사용자의 독후감은 "탈퇴한 사용자"로 표시하여 유지한다 (완전 삭제하지 않음).
